---

doc:
  short_help: Makes sure a file or folder is synced between two locations.
  help: |
    Makes sure a file or folder is synced between two locations.

    This does als create the remote owner/group if necessary.

    For this freckles, the “local host” is the host the synchronize task originates on, and the “destination host” is the host synchronize is connecting to.

  further_reading:
    - "[Ansible synchronize module](https://docs.ansible.com/ansible/2.5/modules/synchronize_module.html)"

args:
  src:
    doc:
      short_help: the host and path of the source
      help: |
        Path on the source host that will be synchronized to the destination.

        Examples:
          - /tmp/freckles/src
          - rsync://dev.frkl.io/tmp/freckles/src

    type: string
    empty: false
    required: true
    cli:
      metavar: PATH
  dest:
    doc:
      short_help: the host and path of the target
      help: |
        Path on the target host that will be synchronized to the destination.

        Examples:
          - /tmp/freckles/dest
          - rsync://dev.frkl.io/tmp/freckles/dest
    type: string
    empty: false
    required: true
    cli:
      metavar: PATH
  owner:
    doc:
      short_help: the owner of the dest folder/file
    type: string
    required: false
    cli:
      metavar: USER
  group:
    doc:
      short_help: the group of the dest folder/file
    type: string
    required: false
    cli:
      metavar: GROUP
  become:
    doc:
      short_help: whether to use root permissions to do the download/chown of target
    type: boolean
    required: false
    default: false
    cli:
      is_flag: true
  delete_on_dest:
    doc:
      short_help: Whether to delete the files on 'dest' that don't exist on the 'src'.
    type: boolean
    required: false
    default: false
    cli:
      metavar: PATH
      show_default: true

meta:
  requirements:
    - rsync installed on both source and target host
  tags:
    - filesystem
    - file
    - sync
    - featured-frecklecutable

frecklets:
  - path-is-synced-impl:
      src: "{{:: src ::}}"
      dest: "{{:: dest ::}}"
      delete: "{{:: delete_on_dest  | default(omit) ::}}"
      become: "{{:: become | default(omit) ::}}"
      delete_on_dest: "{{:: delete_on_dest | default(omit) ::}}"
  - path-is-owned-by:
      frecklet.__skip__: "{{:: owner | true_if_all_empty(group) ::}}"
      path: "{{:: dest ::}}"
      owner: "{{:: owner | default(omit) ::}}"
      group: "{{:: group | default(omit) ::}}"
